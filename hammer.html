<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Goodbye Icy Feet</title>
</head>
<body>
    <div id="allpagecontent">
        <h1>SHATTER THE ICE</h1>
        <p>Click on the screen to hammer.</p>
        <p>Please what a few seconds for the hammer to load BEFORE clicking.</p>
        <br><br><br><br><br><br><br>
    </div>
</body>
<style>
    html{
        background:url(note.png) no-repeat center center fixed;
        background-size: cover;

    }
    body{
        margin:0;
    }
    h1{
        text-align: center;
        color: #8c8cf4;
        font-size: 50px;
        text-shadow: 2px 2px 4px #ffffff;
        font-family: sans-serif;
        font-weight:900;
    }
    p{
        text-align: center;
        color: #8c8cf4;
        font-size: 20px;
        text-shadow: 1px 1px 2px #ffffff;
        font-family: sans-serif;
        font-weight:600;
    }
    #allpagecontent {
        background:url('ice.jpg') no-repeat center center fixed;
        background-size: cover;
        width: 100vw;
        height: 100vh;
        align-content: center;
    }
.shatter-container {
        width: 100vw;
        height: 100vh;
        position: relative;
    }

    .shatter-container img {
        width: 100%;
        height: 100%;
        position: fixed;
        top: 0;
        left: 0;
        transition: transform 1s ease-out, opacity 1s ease-out;
    }

    .shard1 { clip-path: polygon(0% 0%, 18.8% 0%, 42.8% 44.9%, 37% 53%, 0% 43%); }
    .shard2 { clip-path: polygon(18.8% 0%, 38% 0%, 48.2% 51.6%, 47.1% 53.1%); }
    .shard3 { clip-path: polygon(48.2% 51.6%, 47.1% 53.1%, 49.3% 57.5%); }
    .shard4 { clip-path: polygon(49.3% 57.5%, 40.7% 13.7%, 43.4% 14%); }
    .shard5 { clip-path: polygon(38% 0, 40.7% 13.7%, 43.4% 14%, 41.4% 0); }
    .shard6 { clip-path: polygon(41.4% 0, 55.8% 0, 54% 15%, 43.3% 13%); }
    .shard7 { clip-path: polygon(54% 15%, 43.3% 13%, 48.6% 50%, 50.6% 47%); }
    .shard8 { clip-path: polygon(48.6% 50%, 50.6% 47%, 49.3% 57.5%); }
    .shard9 { clip-path: polygon(49.3% 57.5%, 54.3% 14.6%, 55.7% 15%); }
    .shard10 { clip-path: polygon(54.3% 14.6%, 55.7% 15%, 57.6% 0, 55.8% 0); }
    .shard11 { clip-path: polygon(55.7% 15%, 57.6% 0, 83% 0, 72.5% 18.3%); }
    .shard12 { clip-path: polygon(55.7% 15%, 72.5% 18.3%, 57.3% 44.2%, 52% 41%); }
    .shard13 { clip-path: polygon(57.3% 44.2%, 52% 41%, 49.3% 57.5%); }
    .shard14 { clip-path: polygon(83% 0, 100% 0, 100% 23.7%, 63.4% 47.8%, 57.5% 44%); }
    .shard15 { clip-path: polygon(63.4% 47.8%, 57.5% 44%, 49.3% 57.5%); }
    .shard16 { clip-path: polygon(49.3% 57.5%, 100% 23.7%, 100% 56.6%); }
    .shard17 { clip-path: polygon(100% 56.6%, 56% 57%, 53.1% 66%, 60.9% 100%, 100% 100%); }
    .shard18 { clip-path: polygon(56% 57%, 53.1% 66%, 49.3% 57.5%); }
    .shard19 { clip-path: polygon(49.3% 57.5%, 53.7% 78%, 56.9% 78%); }
    .shard20 { clip-path: polygon(53.7% 78%, 56.9% 78%, 60.9% 100%, 56.7% 100%); }
    .shard21 { clip-path: polygon(56.7% 100%, 49% 100%, 49% 80%, 54% 80%); }
    .shard22 { clip-path: polygon(49% 80%, 54% 80%, 49.3% 57.5%); }
    .shard23 { clip-path: polygon(49.3% 57.5%, 49% 80%, 40% 79%); }
    .shard24 { clip-path: polygon(49.3% 57.5%, 40% 79%, 35% 78%); }
    .shard25 { clip-path: polygon(49.3% 57.5%, 20% 100%, 0 100%, 0 43%); }
    .shard26 { clip-path: polygon(49% 80%, 49% 100%, 20% 100%, 35% 78%); }
    .shard27 { clip-path: polygon(42.8% 44.9%, 36% 54%, 49.3% 57.5%); }

    .shattered .shard1 { transform: translate(-30.5%, -35.2%) rotate(-55deg); opacity: 0; transition-duration: 0.8s; }
    .shattered .shard2 { transform: translate(25.8%, -28.1%) rotate(40deg); opacity: 0; transition-duration: 1s; }
    .shattered .shard3 { transform: translate(18.3%, -19.7%) rotate(30deg); opacity: 0; transition-duration: 0.7s; }
    .shattered .shard4 { transform: translate(-15.1%, 25.6%) rotate(-25deg); opacity: 0; transition-duration: 0.9s; }
    .shattered .shard5 { transform: translate(-20.9%, -22.4%) rotate(-20deg); opacity: 0; transition-duration: 1.2s; }
    .shattered .shard6 { transform: translate(22.2%, -28.9%) rotate(35deg); opacity: 0; transition-duration: 0.8s; }
    .shattered .shard7 { transform: translate(-18.5%, 15.3%) rotate(-15deg); opacity: 0; transition-duration: 1s; }
    .shattered .shard8 { transform: translate(-25.7%, 32.8%) rotate(50deg); opacity: 0; transition-duration: 0.9s; }
    .shattered .shard9 { transform: translate(20.4%, -15.6%) rotate(-30deg); opacity: 0; transition-duration: 1.1s; }
    .shattered .shard10 { transform: translate(30.6%, 20.1%) rotate(25deg); opacity: 0; transition-duration: 0.7s; }
    .shattered .shard11 { transform: translate(-25.9%, -35.4%) rotate(60deg); opacity: 0; transition-duration: 1.3s; }
    .shattered .shard12 { transform: translate(28.1%, 22.7%) rotate(-40deg); opacity: 0; transition-duration: 0.8s; }
    .shattered .shard13 { transform: translate(-17.8%, -20.5%) rotate(20deg); opacity: 0; transition-duration: 1s; }
    .shattered .shard14 { transform: translate(35.3%, 30.2%) rotate(-70deg); opacity: 0; transition-duration: 1.5s; }
    .shattered .shard15 { transform: translate(15.9%, 30.8%) rotate(55deg); opacity: 0; transition-duration: 0.9s; }
    .shattered .shard16 { transform: translate(-20.2%, -15.5%) rotate(-35deg); opacity: 0; transition-duration: 1.1s; }
    .shattered .shard17 { transform: translate(20.7%, 25.4%) rotate(45deg); opacity: 0; transition-duration: 0.8s; }
    .shattered .shard18 { transform: translate(-28.6%, -22.9%) rotate(-65deg); opacity: 0; transition-duration: 1.2s; }
    .shattered .shard19 { transform: translate(17.1%, -18.3%) rotate(25deg); opacity: 0; transition-duration: 0.9s; }
    .shattered .shard20 { transform: translate(-22.3%, 23.8%) rotate(-20deg); opacity: 0; transition-duration: 1s; }
    .shattered .shard21 { transform: translate(30.9%, -25.2%) rotate(35deg); opacity: 0; transition-duration: 0.7s; }
    .shattered .shard22 { transform: translate(-15.6%, 32.1%) rotate(60deg); opacity: 0; transition-duration: 1.3s; }
    .shattered .shard23 { transform: translate(-32.7%, -20.8%) rotate(-50deg); opacity: 0; transition-duration: 0.8s; }
    .shattered .shard24 { transform: translate(25.5%, -30.3%) rotate(40deg); opacity: 0; transition-duration: 1.1s; }
    .shattered .shard25 { transform: translate(-35.4%, 35.7%) rotate(70deg); opacity: 0; transition-duration: 1.5s; }
    .shattered .shard26 { transform: translate(30.1%, 15.9%) rotate(-25deg); opacity: 0; transition-duration: 0.9s; }
    .shattered .shard27 { transform: translate(0.3%, -20.6%) rotate(15deg); opacity: 0; transition-duration: 1s; }
    .shattered .normal { display: none; }
  </style>
  <!-- Three.js + GLTF Loader -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.146.0/build/three.min.js"></script>
  <script src="https://unpkg.com/three@0.146.0/examples/js/loaders/GLTFLoader.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script>
const fractureImages = [];
for (let i = 1; i <= 4; i++) {
  const img = new Image();
  img.src =`fracture${i}.png`;
  fractureImages.push(img);
}

const fractureCanvas = document.createElement('canvas');
fractureCanvas.id = 'fractureCanvas';
fractureCanvas.width = window.innerWidth;
fractureCanvas.height = window.innerHeight;
fractureCanvas.style.position = 'fixed';
fractureCanvas.style.top = '0';
fractureCanvas.style.left = '0';
fractureCanvas.style.pointerEvents = 'none';
fractureCanvas.style.zIndex = '1000'; // Ensure it's on top
document.body.appendChild(fractureCanvas);
const fractureCtx = fractureCanvas.getContext('2d');

window.addEventListener('resize', () => {
  fractureCanvas.width = window.innerWidth;
  fractureCanvas.height = window.innerHeight;
});

    const hammerLength = 0.12; // Length of the hammer head

function stampFracture() {
  const hammerHeadLocal = new THREE.Vector3(0, hammerLength, 0); 
  hammerHeadLocal.applyMatrix4(hammerGroup.matrixWorld);

  const hammerHeadScreen = hammerHeadLocal.clone().project(camera);
  const x = ((hammerHeadScreen.x + 1) / 2) * fractureCanvas.width;
  const y = ((-hammerHeadScreen.y + 1) / 2) * fractureCanvas.height;

  // Pick a random fracture image and rotation
  const img = fractureImages[Math.floor(Math.random() * fractureImages.length)];
  const angle = Math.random() * Math.PI * 2;

  // Draw with rotation
  const size = 150;
  fractureCtx.save();
  fractureCtx.translate(x, y);
  fractureCtx.rotate(angle);
  fractureCtx.drawImage(img, -size / 2, -size / 2, size, size);
  fractureCtx.restore();
}
    const canvas = document.createElement('canvas');
    canvas.id = 'hammerCanvas';
    const renderer = new THREE.WebGLRenderer({ canvas, alpha: true, antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
canvas.style.zIndex = '2000'; // Ensure canvas is on top
canvas.style.position = 'fixed';
canvas.style.top = '0';
canvas.style.left = '0';
    document.body.appendChild(canvas);
    const scene = new THREE.Scene();
    scene.background = null;
    const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 100);
    camera.position.z = 5;

    const ambientLight = new THREE.AmbientLight(0xffffff, 4);
    scene.add(ambientLight);
    const directionalLight = new THREE.DirectionalLight(0xffffff, 4);
directionalLight.position.set(5, 10, 7.5);
scene.add(directionalLight);

    const loader = new THREE.GLTFLoader();
    let hammer, hammerGroup;
    loader.load('/hammer2.glb', gltf => {
  hammer = gltf.scene;
  hammer.scale.set(0.003, 0.003, 0.003);

  // Compute the bounding box for the whole hammer
  const box = new THREE.Box3().setFromObject(hammer);
  const minY = box.min.y;

  // Move the whole hammer so its base is at y=0
  hammer.position.y -= minY;
  hammer.rotation.z = -Math.PI / 2.5; // Rotate to face up
  hammer.rotation.y = -Math.PI / 1.7; // Rotate to face the camera

  // Create a group and add the hammer to it
  hammerGroup = new THREE.Group();
  hammerGroup.add(hammer);
  scene.add(hammerGroup);
});

    const mouse = new THREE.Vector2(0, 0);
    window.addEventListener('mousemove', e => {
      mouse.x = (e.clientX / window.innerWidth) * 2 - 1;
      mouse.y = -(e.clientY / window.innerHeight) * 2 + 1;
    });

    let isHammering = false;
    let hammerRotation = 0;

    window.addEventListener('click', () => {
      if (!isHammering) {
        isHammering = true;
        hammerRotation = 0;
      }
    });
    let numberOfClicks = 0;
    function animate() {
  requestAnimationFrame(animate);

  if (hammerGroup && hammer) {
    const baseNDC = new THREE.Vector3(0, -1, 0);
    const baseWorld = baseNDC.clone().unproject(camera);

    const mouseNDC = new THREE.Vector3(mouse.x, mouse.y, 0);
    const mouseWorld = mouseNDC.clone().unproject(camera);

    const direction = mouseWorld.clone().sub(baseWorld);
    direction.normalize();

    hammerGroup.position.copy(mouseWorld);
    hammerGroup.position.add(direction.clone().multiplyScalar(-hammerLength));

    const up = new THREE.Vector3(0, 1, 0); // local up
    const targetQuat = new THREE.Quaternion().setFromUnitVectors(up, direction);
    hammerGroup.quaternion.copy(targetQuat);

    if (isHammering) {
      hammerRotation -= 0.3;
      const hammerSwing = Math.sin(hammerRotation) * 0.6;
      hammerGroup.rotation.x = hammerSwing;

      if (hammerRotation <= -Math.PI) {
        isHammering = false;
        hammerGroup.rotation.x = 0;
        stampFracture(); // Stamp fracture when hammering finishes
        numberOfClicks++;
        if (numberOfClicks >=25){
            document.querySelector('.shatter-container').classList.add('shattered');
            document.querySelector('#fractureCanvas').style.display = 'none';
            document.querySelector('#hammerCanvas').style.display = 'none';
        }
      }
    }
  }

  renderer.render(scene, camera);
}
    animate();

    window.addEventListener('resize', () => {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });



    // shatter effect
    const window_canvas = html2canvas(document.querySelector("html"), {
        useCORS: true, // this does: allow cross-origin images to be used
        allowTaint: true, // Allow cross-origin images  
        scale: 1,
        //backgroundColor: null, //rhis does: make the background transparent
    });
    const shatter_container = document.createElement('div');
    shatter_container.className = 'shatter-container';
    window_canvas.then(canvas => {
        const img = new Image();
        img.src = canvas.toDataURL();
        img.onload = () => {
            const normal = document.createElement('img');
            normal.src = img.src;
            normal.className = 'normal';
            shatter_container.appendChild(normal);
            for(let i = 0; i < 27; i++){
                const shatter = document.createElement('img');
                shatter.src = img.src;
                shatter.className = 'shard'+(i+1);
                shatter_container.appendChild(shatter);
            }
            document.body.appendChild(shatter_container);
            document.querySelector('#allpagecontent').style.display = 'none';
        }
    });

  </script>
